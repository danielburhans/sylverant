# Introduction #

Sylverant has various files that must be set up to configure the various parts of the Sylverant server. Generally, all Sylverant-related files are placed in /usr/local/share/sylverant (henceforth assumed to be in front of any paths), but this can be configured when you compile libsylverant.

# Configuring Sylverant Ship Server #

The base configuration file for configuring the Ship Server is called ship\_config.xml, and is placed in the config directory. Each ship has its own configuration file. If you wish to run multiple ships on one machine, then you can use the -C and -D flags to ship\_server to change the configuration file read and the base Sylverant directory. The layout of this file is as follows (current as of 2013-10-08):

```
<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE ships PUBLIC "-//Sylverant//DTD Ship Configuration 1.14//EN"
  "http://sylverant.net/dtd/ship_config1.14/ship_config.dtd">

<ships>
    <shipgate addr="Shipgate Address" port="Shipgate Port"
     ca="Shipgate CA Certificate File" />
    <ship name="Ship Name" blocks="Number of Blocks" key="Ship Private Key File"
     cert="Ship Certificate File" gms="GM File" menu="Menu Code"
     gmonly="Enable GM Only Mode">
        <net port="Ship Base Port" addr="Ship Address" ip="Ship IP Address" 
          ip6="Ship IPv6 Address" addr6="Ship IPv6 Hostname" />
        <versions v1="Allow PSOv1" v2="Allow PSOv2" pc="Allow PSO for PC" gc="Allow PSO for Gamecube"
          ep3="Allow PSO Episode III" bb="Allow Blue Burst" dcnte="Allow Dreamcast NTE" />
        <events>
            <defaults lobby="Default Lobby Event" game="Default Team Event" />
            <event game="Team Event Number" lobby="Lobby Event Number">
                <start month="Start Month" day="Start Day" />
                <end month="End Month" day="End Day" />
            </event>
        </events>
        <info file="Info Filename" desc="Info Title" v1="Show Info to PSOv1"
         v2="Show Info to PSOv2" pc="Show Info to PSO for PC"
         languages="Language Codes to show Info to" />
        <quests dir="Quest Directory" />
        <limits file="Item List File" />
        <motd file="Message of the Day File"  v1="Show MOTD to PSOv1"
         v2="Show MOTD to PSOv2" pc="Show MOTD to PSO for PC"
         languages="Language Codes to show MOTD to" />
        <bans file="Bans File" />
        <bbmaps dir="Blue Burst Map Directory" />
        <v2maps dir="PSOv2 Map Directory" />
        <gcmaps dir="Gamecube Map Directory" />
        <bbparam dir="Blue Burst Parameter Directory" />
        <itempt v2="PSOv2 ItemPT File" gc="Gamecube ItemPT File"
         bb="Blue Burst ItemPT File" />
        <itempmt v2="PSOv2 ItemPMT File" gc="Gamecube ItemPMT File"
         bb="Blue Burst ItemPMT File" limitv2units="Limit PSOv2 Units"
         limitgcunits="Limit Gamecube Units" limitbbunits="Limit Blue Burst Units" />
        <itemrt v2="PSOv2 ItemRT File" gc="Gamecube ItemRT File"
         bb="Blue Burst ItemRT File" questrares="Rares Drop in Quests" />
    </ship>
</ships>
```

The various fields are explained below:
  * Shipgate Address: The IP Address or DNS Hostname of the Shipgate to connect to.
  * Shipgate Port: The port to connect to the Shipgate on. This is set by the shipgate administrator -- contact them for the correct value to set here.
  * Shipgate CA Certificate File: The filename of the CA Certificate for the shipgate. This is relative to the base Sylverant directory (usually /usr/local/share/sylverant). This must be a PEM-encoded certificate.
  * Ship Name: The name you wish to call your ship. This should be less than 16 characters in length.
  * Number of Blocks: Should be obvious what this is for.
  * Ship Private Key File: A PEM-encoded private key used to encrypt communications with the shipgate. This should normally be generated by you when you set up the ship and a Code Signing Request sent to the shipgate operator to create a signed certificate.
  * Ship Certificate File: A PEM-encoded certificate signed with the Shipgate CA key that has been provided by the shipgate operator.
  * GM File: The XML file to configure the list of GMs for this ship (described below)
  * Menu Code: The submenu of the shipgate to put this ship in. Unless the ship has been specially set up in the Database (the main\_menu column of the ship\_data table has been set to non-zero), this must be a valid 2 alphabetic character code. Basically, this _should_ be the two-character country code of the location of the ship, but this isn't strictly enforced. This should be omitted if the ship is to appear in the main menu of the shipgate.
  * Enable GM Only Mode: Set this to either "true" or "false" (default is false if its omitted) to limit the ship to only being able to be accessed by Global GMs.
  * Base Ship Port: The port to start allocating ports for ship connections. The program will allocate (number of blocks + 1) `*` 5 ports currently, and this is subject to change.
  * Ship Address: The publicly accessible DNS Hostname for the ship.
  * Ship IP Address: The publicly accessible IPv4 address for the ship. This is optional and has been superseded by the Ship Address entry (you probably shouldn't specify both).
  * Ship IPv6 Address: The publicly accessible IPv6 address for the ship. This is optional. If you specify a Ship Address entry that resolves to both an IPv6 and IPv4 address (or use the addr6 option), this shouldn't be needed.
  * Ship IPv6 Hostname: The publicly accessible DNS Hostname for the ship that resolves to an IPv6 address. This is optional, and if you specify a Ship Address entry that resolves to both an IPv4 and IPv6 address is completely unnecessary.
  * Allow PSOv1, Allow PSOv2, Allow PSO for PC, Allow Gamecube, Allow Episode III, Allow Blue Burst, Allow Dreamcast NTE: Set to "false" to disallow the specified version. Set to "true" to enable it. By default all versions are enabled. Note that Blue Burst support may be disabled by the server if various other required configuration parameters are missing or incorrect.
  * Default Lobby Event: Set the event that's shown in the lobby. Lobby events aren't supported on PSODC/PSOPC. Valid values are 0-14.
  * Default Game Event: Set the event that's shown in games. These, unlike lobby events, are supported on all versions of PSO. Valid values are 0-6. In addition, you can define various events to be triggered based on the date by setting them up with `<event>` tags.
  * Info Filename/Info Title: The text shown at the lobby counter when the user selects the Information option. You can have multiple files here. The file itself should be a normal UTF-8 text file, and the description should be less than 16 characters in length. I suggest placing the information files in a "info" directory off the top of the sylverant directory, but that's not a strict requirement. These only work on PSODC/PSOPC since the Information option doesn't exist on PSOGC. You can specify whether or not to show this information entry to each version by setting the corresponding flag to "true" or "false" here. Also, you can specify information entries for each language code by using that setting -- separate each language by a comma. The default is to show each entry to all languages and all versions if none of the settings are specified.
  * Quest Directory: A directory tree containing quests. See the ConfiguringQuests page for more information about how the quest directory should be set up.
  * Item List File: The list of items that are to be used for /legit. See the legits.xml in the ship\_server for a full example of how to set it up.
  * Message of the Day File: A text file that is used to send a message to clients when they connect. These messages currently will show up for Dreamcast and PC clients when they join the lobby, and are not supported on any other versions. Keep the messages fairly short, as there's no way to scroll them on PSODC/PSOPC (they appear in the same large message box as the info desk entries). Like the information desk stuff, this can be limited by versions and languages.
  * Bans File: The filename to use to store local (ship-level) bans. If this file is not specified, bans will not persist when the server is restarted. You must make sure that the server can write to the specified file, otherwise the file won't be saved. The server will completely manage this file, so you don't have to worry about creating the file ahead of time or doing anything to it in general (hence why I haven't documented the format of the file, not that its hard to figure out).
  * Blue Burst Map Directory, PSOv2 Map Directory, Gamecube Map Directory: Each of these directories should contain the map files from the corresponding version of the game. This is only needed for Server-Side Drops. To support Blue Burst, you must configure the maps for it. This will be detailed more in the future.
  * Blue Burst Parameter Directory: Directory containing the Blue Burst parameter files that are sent to clients when they connect. This Directory should have the following files: BattleParamEntry\_ep4\_on.dat, BattleParamEntry\_ep4.dat, BattleParamEntry\_lab\_on.dat, BattleParamEntry\_lab.dat, BattleParamEntry\_on.dat, BattleParamEntry.dat, ItemMagEdit.prs, ItemPMT.prs, PlyLevelTbl.prs. This is required for Blue Burst support (so you don't need to include it if you don't want to support Blue Burst).
  * PSOv2 ItemPT File: The ItemPT.afs file from either PSOv2 or PSO for PC. This is optional and only needed for Server-Side drops on PSOv2.
  * Gamecube ItemPT File, Blue Burst ItemPT File: The ItemPT.gsl file from the corresponding version of the game. For Gamecube, this is optional (but will disable server-side drops on PSOGC if you don't have it). It is required for Blue Burst support.
  * PSOv2 ItemPMT File, Gamecube ItemPMT File, Blue Burst ItemPMT file: These should point to the ItemPMT.prs files from the corresponding version of the game. These are optional for all versions of the game except Blue Burst and only required for Server-Side drops. For Blue Burst, this should point to the ItemPMT.prs file that is in the configured parameter directory.
  * Limit PSOv2 Units, Limit Gamecube Units, Limit Blue Burst Units: Apply a few additional limits to generated units beyond what the ItemPMT file specifies. These were hard-coded into the game by Sega, apparently. Set to "true" (or omit the flag) to enforce these limits on generated items or "false" to not enforce those limits).
  * PSOv2 ItemRT File: The ItemRT.afs file from either PSOv2 or PSO for PC. This is optional and only needed for Server-Side drops on PSOv2.
  * Gamecube ItemRT File, Blue Burst ItemRT File: The ItemRT.gsl file from the corresponding version of the game. For Gamecube, this is optional (but will disable server-side drops on PSOGC if you don't have it). It is required for Blue Burst support.
  * Rares Drop in Quests: Set to "true" to have rare items drop in quests on PSOv2 when server-side drops are on. Set to "false" to disable this behavior and have it act like the game's own drop code. Set to "partial" to make it so that common rare items (i.e, things not generated by the ItemRT file) drop in quests. This defaults to "false" if omitted.

## GM Configuration ##

The GM configuration file is a simple XML list of guildcards for the users that should have GM permissions on the ship. I call the file iselia\_gms.xml for the Iselia ship, but once again, this is configurable in the ship\_config.xml file above. This file also used to include the serial numbers and access keys of the users, but this requirement was dropped in [r714](https://code.google.com/p/sylverant/source/detail?r=714) of the ship server as it was redundant and actually prevented Blue Burst users from being given GM powers on a ship.

```
<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE gms PUBLIC "-//Sylverant//DTD Ship GM List 1.1//EN" 
  "http://sylverant.net/dtd/gms1.1/gms.dtd">

<gms>
    <gm guildcard="Guild Card Number" root="Give Root Privileges" />
</gms>
```

For each person in the list, you must place each element in its prescribed place. You can provide multiple GMs in the file (and probably will). Put the user's guildcard number in the Guild Card Number space. You can specify either "true" or "false" for the Give Root Privileges part, depending on whether you want that user to have full privileges on the ship (including the ability to shut down the ship and restart it).

## Map Files ##

**This section needs to be expanded to detail where to find the files in the various versions of the game.**

In order to support server-side drops for each version of the game, the server needs the map enemy and object data from the game itself. For PSOv2, you should be able to easily find the files on the disc of the game or in an installed version of PSO for PC. For the other versions, it is a bit more work to get the files as Sega hid them away in an archive file.

For PSOv2, you should have two files for each area/map/variation combination: mxyz.dat and mxyz\_o.dat, where x, y, and z refer to the area, map, and variation number respectively (area is a hex digit from 0-E -- digits from A-E must be capitalized). The first of these files is the enemy data, the second is the object data. Note that this **does not** follow the naming convention used by the game itself.

For Gamecube, you will have maps for episode 1 and episode 2. For this, the filenames have changed to mwxyz.dat and mwxyz\_o.dat. x, y, and z are as they are for the Dreamcast version, and w is 1 for episode 1 or 2 for episode 2.

For Blue Burst, there are also single-player maps. By default, the normal map is used if a single-player variant is not found. If you have a single-player variant of the map, it should be named swxyz.dat, where w, x, y, and z are as they are for the Gamecube map set. One thing to note is that w is 3 for Episode 4.